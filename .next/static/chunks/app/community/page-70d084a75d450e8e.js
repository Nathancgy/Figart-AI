(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[28],{7146:(e,t,o)=>{"use strict";o.d(t,{A:()=>l,AuthProvider:()=>i});var s=o(5155),r=o(2115),n=o(8547);let a=(0,r.createContext)(null);function i(e){let{children:t}=e,[o,i]=(0,r.useState)(null);return(0,r.useEffect)(()=>{if((0,n.c4)()){let e=localStorage.getItem("username");e&&i(e)}},[]),(0,s.jsx)(a.Provider,{value:{username:o,setUsername:i,logout:()=>{(0,n.QF)(),localStorage.removeItem("username"),i(null)}},children:t})}function l(){let e=(0,r.useContext)(a);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},7206:(e,t,o)=>{Promise.resolve().then(o.bind(o,9991))},8134:(e,t,o)=>{"use strict";o.d(t,{H$:()=>r,ed:()=>n});var s=o(2818);let r=()=>{if(console.log("Environment variables:",{NEXT_PUBLIC_API_URL:s.env.NEXT_PUBLIC_API_URL}),s.env.NEXT_PUBLIC_API_URL)return console.log("Using API URL from environment variable:",s.env.NEXT_PUBLIC_API_URL),s.env.NEXT_PUBLIC_API_URL;{let{protocol:e,hostname:t}=window.location;if(console.log("Current hostname:",t),"localhost"===t||"127.0.0.1"===t){let o="".concat(e,"//").concat(t,":8000");return console.log("Using local API URL:",o),o}let o="".concat(e,"//").concat(t,":8000");return console.log("Using dynamic API URL based on hostname:",o),o}},n=e=>{let t="".concat(r(),"/photos/").concat(e);return console.log("Photo URL generated:",t),t}},8547:(e,t,o)=>{"use strict";function s(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var s in o)e[s]=o[s]}return e}o.d(t,{AT:()=>h,c4:()=>l,iD:()=>d,QF:()=>c,$5:()=>u});var r=function e(t,o){function r(e,r,n){if("undefined"!=typeof document){"number"==typeof(n=s({},o,n)).expires&&(n.expires=new Date(Date.now()+864e5*n.expires)),n.expires&&(n.expires=n.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var a="";for(var i in n){if(n[i])a+="; "+i,!0!==n[i]&&(a+="="+n[i].split(";")[0])}return document.cookie=e+"="+t.write(r,e)+a}}return Object.create({set:r,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var o=document.cookie?document.cookie.split("; "):[],s={},r=0;r<o.length;r++){var n=o[r].split("="),a=n.slice(1).join("=");try{var i=decodeURIComponent(n[0]);if(s[i]=t.read(a,i),e===i)break}catch(e){}}return e?s[e]:s}},remove:function(e,t){r(e,"",s({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,s({},this.attributes,t))},withConverter:function(t){return e(s({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(o)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"}),n=o(8134);let a="auth_token",i=e=>{r.set(a,e,{expires:7})},l=()=>r.get(a),c=()=>{r.remove(a)},d=async(e,t)=>{let o=await fetch("".concat((0,n.H$)(),"/users/login/"),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",mode:"cors",body:JSON.stringify({username:e,password:t})}),s=await o.json().catch(()=>null);if(!o.ok){if(401===o.status)throw Error("Invalid username or password");throw Error((null==s?void 0:s.detail)||"Login failed")}if(!(null==s?void 0:s.token))throw Error("No token received");return i(s.token),s},u=async(e,t)=>{let o=await fetch("".concat((0,n.H$)(),"/users/register/"),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",mode:"cors",body:JSON.stringify({username:e,password:t})}),s=await o.json().catch(()=>null);if(!o.ok){if(409===o.status)throw Error("Username already exists");throw Error((null==s?void 0:s.detail)||"Registration failed")}if(!(null==s?void 0:s.token))throw Error("No token received");return i(s.token),s},h=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=l(),s={"Content-Type":"application/json",Accept:"application/json",...o&&{Authorization:"Bearer ".concat(o)},...t.headers},r=await fetch("".concat((0,n.H$)()).concat(e),{...t,headers:s,credentials:"include",mode:"cors"}),a=await r.json().catch(()=>null);if(!r.ok)throw Error((null==a?void 0:a.detail)||"API request failed");return a}},9991:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>d});var s=o(5155),r=o(2115),n=o(8173),a=o.n(n),i=o(8547),l=o(7146),c=o(8134);function d(){let{username:e}=(0,l.A)(),t=(0,r.useRef)(null),o=(0,r.useRef)(null),[n,d]=(0,r.useState)([]),[u,h]=(0,r.useState)([]),[p,g]=(0,r.useState)(!0),[m,x]=(0,r.useState)(null),[f,b]=(0,r.useState)(!1),[v,w]=(0,r.useState)("recent"),[y,j]=(0,r.useState)(!1),[k,N]=(0,r.useState)(0),[C,E]=(0,r.useState)(!0),[_,L]=(0,r.useState)(!1),[P,S]=(0,r.useState)(0);(0,r.useEffect)(()=>{function e(e){o.current&&!o.current.contains(e.target)&&j(!1)}return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),(0,r.useEffect)(()=>{if(m){let e=setTimeout(()=>{x(null)},5e3);return()=>clearTimeout(e)}},[m]),(0,r.useEffect)(()=>{U(!0),e?A():(h([]),localStorage.removeItem("likedPosts"))},[e,v]);let A=async()=>{if(e)try{let e=await (0,i.AT)("/users/liked-posts/");e&&e.liked_posts&&(h(e.liked_posts),localStorage.setItem("likedPosts",JSON.stringify(e.liked_posts)))}catch(t){console.error("Error fetching liked posts:",t);let e=localStorage.getItem("likedPosts");if(e)try{h(JSON.parse(e))}catch(e){console.error("Error loading liked posts from localStorage",e)}}},U=async function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];try{e?(g(!0),N(0)):L(!0);let t=await (0,i.AT)("/posts/?sort_by=".concat(v,"&page=").concat(e?0:k));e?d(t.posts):d(e=>[...e,...t.posts]),E(t.pagination.page<t.pagination.pages-1),S(t.pagination.pages),e||N(e=>e+1)}catch(e){x("Failed to load posts"),console.error("Error fetching posts:",e)}finally{g(!1),L(!1)}},I=e=>{if(e!==k&&!p&&!_){N(e),window.scrollTo({top:0,behavior:"smooth"});try{g(!0),(0,i.AT)("/posts/?sort_by=".concat(v,"&page=").concat(e)).then(e=>{d(e.posts),E(e.pagination.page<e.pagination.pages-1),S(e.pagination.pages)}).catch(e=>{x("Failed to load posts"),console.error("Error fetching posts:",e)}).finally(()=>{g(!1)})}catch(e){x("Failed to load posts"),console.error("Error fetching posts:",e),g(!1)}}},T=e=>{e!==v?(w(e),j(!1),N(0),g(!0),(0,i.AT)("/posts/?sort_by=".concat(e,"&page=0")).then(e=>{d(e.posts),E(e.pagination.page<e.pagination.pages-1),S(e.pagination.pages)}).catch(e=>{x("Failed to load posts"),console.error("Error fetching posts:",e)}).finally(()=>{g(!1)})):j(!1)},R=async e=>{var o;let s=null===(o=e.target.files)||void 0===o?void 0:o[0];if(s)try{b(!0),x(null);let e=(0,i.c4)();if(!e)throw Error("Not authenticated");let o=new FormData;o.append("file",s);let r=await fetch("".concat((0,c.H$)(),"/posts/create/"),{method:"POST",headers:{Authorization:"Bearer ".concat(e)},body:o});if(!r.ok){let e=await r.json().catch(()=>null);throw Error((null==e?void 0:e.detail)||"Failed to create post")}await U(),t.current&&(t.current.value="")}catch(e){console.error("Error uploading:",e),x(e instanceof Error?e.message:"Failed to upload photo")}finally{b(!1)}},B=async t=>{if(!e){x("You must be logged in to like posts");return}try{x(null);let e=u.includes(t),o=e?"/posts/".concat(t,"/thumbs-down/"):"/posts/".concat(t,"/thumbs-up/"),s=e?u.filter(e=>e!==t):[...u,t];if(d(n.map(o=>o.id===t?{...o,thumbs_up:e?Math.max(0,o.thumbs_up-1):o.thumbs_up+1}:o)),h(s),!await (0,i.AT)(o,{method:"POST"}))throw Error("Failed to update like status");localStorage.setItem("likedPosts",JSON.stringify(s))}catch(e){console.error("Error liking post:",e),await U(),await A(),e instanceof Error?e.message.includes("You already thumbed up")||e.message.includes("You haven't thumbed up")?x("Your like status was out of sync. We've refreshed the data."):x(e.message):x("Failed to like post")}};return(0,s.jsxs)("div",{className:"min-h-screen py-12",children:[(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[m&&(0,s.jsxs)("div",{className:"mb-6 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert",children:[(0,s.jsx)("strong",{className:"font-bold",children:"Error: "}),(0,s.jsx)("span",{className:"block sm:inline",children:m}),(0,s.jsx)("button",{className:"absolute top-0 bottom-0 right-0 px-4 py-3",onClick:()=>x(null),"aria-label":"Close error message",children:(0,s.jsxs)("svg",{className:"fill-current h-6 w-6 text-red-500",role:"button",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:[(0,s.jsx)("title",{children:"Close"}),(0,s.jsx)("path",{d:"M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"})]})})]}),(0,s.jsxs)("div",{className:"text-center mb-12",children:[(0,s.jsx)("h1",{className:"text-4xl font-extrabold text-white sm:text-5xl sm:tracking-tight lg:text-6xl",children:"Photography Community"}),(0,s.jsx)("p",{className:"mt-4 max-w-2xl mx-auto text-xl text-indigo-200",children:"Share your photos, get feedback, and be inspired by other photographers."})]}),(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-6 mb-12",children:[(0,s.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"recent"===v?"Recent Photos":"Most Liked Photos"}),(0,s.jsx)("p",{className:"text-gray-500",children:"recent"===v?"Explore the latest uploads from our community":"Discover the most popular photos in our community"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("div",{className:"relative",ref:o,children:[(0,s.jsxs)("button",{onClick:()=>j(!y),className:"px-4 py-2 bg-white border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors flex items-center",children:[(0,s.jsxs)("span",{children:["Sort by: ","recent"===v?"Recent":"Most Liked"]}),(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 ml-2",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 8.25l-7.5 7.5-7.5-7.5"})})]}),y&&(0,s.jsxs)("div",{className:"absolute right-0 mt-1 w-48 bg-white border border-gray-200 rounded-md shadow-lg z-10",children:[(0,s.jsx)("button",{onClick:()=>{T("recent"),j(!1)},className:"block w-full text-left px-4 py-2 hover:bg-gray-100 ".concat("recent"===v?"bg-indigo-50 text-indigo-700":"text-gray-700"),children:"Recent"}),(0,s.jsx)("button",{onClick:()=>{T("likes"),j(!1)},className:"block w-full text-left px-4 py-2 hover:bg-gray-100 ".concat("likes"===v?"bg-indigo-50 text-indigo-700":"text-gray-700"),children:"Most Liked"})]})]}),e&&(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:"file",ref:t,onChange:R,accept:"image/*",className:"hidden","aria-label":"Upload photo"}),(0,s.jsx)("button",{onClick:()=>{var e;return null===(e=t.current)||void 0===e?void 0:e.click()},disabled:f,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors disabled:bg-indigo-400",children:f?"Uploading...":"Post a Picture"})]})]})]}),p?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-4 border-indigo-500 border-t-transparent"}),(0,s.jsx)("p",{className:"mt-2 text-gray-500",children:"Loading posts..."})]}):0===n.length?(0,s.jsx)("div",{className:"text-center py-12",children:(0,s.jsx)("p",{className:"text-gray-500",children:"No posts yet. Be the first to share a photo!"})}):(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n.map(e=>(0,s.jsxs)("div",{className:"border rounded-xl overflow-hidden shadow-sm hover:shadow-md transition",children:[(0,s.jsx)("div",{className:"relative pb-[75%] bg-gray-100",children:(0,s.jsx)(a(),{href:"/posts/".concat(e.id),children:(0,s.jsx)("img",{src:(0,c.ed)(e.photo_uuid),alt:"Post ".concat(e.id),className:"absolute inset-0 w-full h-full object-cover cursor-pointer"})})}),(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:["By: ",e.user_id]})}),(0,s.jsxs)("button",{onClick:()=>B(e.id),className:"flex items-center text-gray-500 hover:text-red-500 transition-colors focus:outline-none","aria-label":u.includes(e.id)?"Unlike post":"Like post",children:[u.includes(e.id)?(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5 mr-1 text-red-500",children:(0,s.jsx)("path",{d:"M11.645 20.91l-.007-.003-.022-.012a15.247 15.247 0 01-.383-.218 25.18 25.18 0 01-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0112 5.052 5.5 5.5 0 0116.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 01-4.244 3.17 15.247 15.247 0 01-.383.219l-.022.012-.007.004-.003.001a.752.752 0 01-.704 0l-.003-.001z"})}):(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 mr-1",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"})}),(0,s.jsx)("span",{children:e.thumbs_up})]})]}),(0,s.jsxs)("div",{className:"mt-4 flex justify-between",children:[(0,s.jsx)("div",{className:"text-sm text-gray-500",children:new Date(e.created_at).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}),(0,s.jsx)(a(),{href:"/posts/".concat(e.id),className:"text-indigo-600 hover:text-indigo-800 text-sm font-medium",children:"View Details"})]})]})]},e.id))})]})]}),P>1&&(0,s.jsx)("div",{className:"flex justify-center my-8",children:(0,s.jsxs)("div",{className:"inline-flex items-center gap-2 bg-white p-2 rounded-lg shadow",children:[(0,s.jsx)("button",{onClick:()=>I(Math.max(0,k-1)),disabled:0===k||p,className:"px-3 py-1 rounded-md bg-white text-gray-700 hover:bg-gray-100 disabled:opacity-50 disabled:hover:bg-white","aria-label":"Previous page",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})})}),(()=>{let e=[];if(e.push((0,s.jsx)("button",{onClick:()=>I(0),className:"px-3 py-1 rounded-md ".concat(0===k?"bg-indigo-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"),disabled:p,children:"1"},"first")),2===P)return e.push((0,s.jsx)("button",{onClick:()=>I(1),className:"px-3 py-1 rounded-md ".concat(1===k?"bg-indigo-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"),disabled:p,children:"2"},"page2")),e;let t=Math.max(1,k-Math.floor(2.5)),o=Math.min(P-1,t+5-2);o-t<3&&(t=Math.max(1,o-3)),t>1&&e.push((0,s.jsx)("span",{className:"px-2",children:"..."},"ellipsis1"));for(let r=t;r<=o;r++)e.push((0,s.jsx)("button",{onClick:()=>I(r),className:"px-3 py-1 rounded-md ".concat(k===r?"bg-indigo-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"),disabled:p,children:r+1},r));return o<P-1&&e.push((0,s.jsx)("span",{className:"px-2",children:"..."},"ellipsis2")),P>2&&e.push((0,s.jsx)("button",{onClick:()=>I(P-1),className:"px-3 py-1 rounded-md ".concat(k===P-1?"bg-indigo-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"),disabled:p,children:P},"last")),e})(),(0,s.jsx)("button",{onClick:()=>I(Math.min(P-1,k+1)),disabled:k===P-1||p,className:"px-3 py-1 rounded-md bg-white text-gray-700 hover:bg-gray-100 disabled:opacity-50 disabled:hover:bg-white","aria-label":"Next page",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})})]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[441,587,358],()=>t(7206)),_N_E=e.O()}]);